<class name="input">
  <script>
    binding.element = document.createElement('INPUT');
    binding.setValue = function(v) {
      binding.element.value = v.toString();
    };
    binding.getValue = function() {
      return binding.element.value;
    };
    binding.element.addEventListener('focus', function(evt) {
      binding.valueOnFocus = binding.element.value;
    });
    binding.element.addEventListener('blur', function(evt) {
      if (binding.element.value != binding.valueOnFocus) {
        binding.notifyChange();
      }
    });
    binding.focus = function() {
      binding.element.focus();
    };
  </script>
</class>

<class name="literal">
  <script>
    binding.original = '';
    binding.setValue = function(v) {
      binding.original = v;
      binding.element.innerText = v.toString();
    };
    binding.getValue = function() {
      return binding.original;
    };
  </script>
</class>

<class name="list">
  <script>
    binding.listPart = document.createElement('SPAN');

    if ('add' in binding.attributes) {
      binding.listPart = document.createElement('SPAN');
      binding.addPart = document.createElement('SPAN');
      binding.element.appendChild(binding.listPart);
      binding.element.appendChild(binding.addPart);

      var contentTemplate = namespace.get('CONTENT');

      var button = document.createElement('BUTTON');
      button.innerText = '+';
      button.addEventListener('click', function(evt) {
        var elementBinding = contentTemplate(null, null, null);
        binding.model.push(elementBinding);
        binding.listPart.appendChild(elementBinding.element);

        if ('delete' in binding.attributes) {
          binding.appendDeleteButton(elementBinding);
        }

        binding.notifyChange();
        elementBinding.focus();
      });
      binding.addPart.appendChild(button);
    } else {
      binding.listPart = binding.element;
    }

    binding.model = [];
    binding.getValue = function() {
      var result = [];
      for (var i = 0; i < binding.model.length; ++i) {
        result.push(binding.model[i].getValue());
      }
      return result;
    };
    binding.setValue = function(v) {
      binding.model = [];
      binding.listPart.innerHTML = '';

      var contentTemplate = namespace.get('CONTENT');
      if (contentTemplate != null) {
        for (var i = 0; i < v.length; ++i) {
          if (('delimiter' in binding.attributes) && (i > 0)) {
            var span = document.createElement('SPAN');
            span.innerHTML = binding.attributes.delimiter;
            binding.listPart.appendChild(span);
          }

          var elementBinding = contentTemplate(null, null, null);
          binding.model.push(elementBinding);
          binding.listPart.appendChild(elementBinding.element);
          elementBinding.setValue(v[i]);
        }
      } else {
        binding.element.innerText = 'CONTENT is not defined';
      }
    };
    binding.appendDeleteButton = function(elementBinding) {
      var button = document.createElement('BUTTON');
      button.innerText = 'X';
      button.addEventListener('click', function(evt) {
        var modelIndex = binding.model.indexOf(elementBinding);
        binding.model.splice(modelIndex, 1);
        binding.listPart.removeChild(elementBinding.element);
        binding.listPart.removeChild(button);
        binding.notifyChange();
      });

      binding.listPart.appendChild(button);
    };
  </script>
</class>
