<class name="input">
  <script>
    binding.element = document.createElement('INPUT');
    binding.setValue = function(v) {
      binding.element.value = v.toString();
    };
    binding.getValue = function() {
      return binding.element.value;
    };
  </script>
</class>

<class name="literal">
  <script>
    binding.original = '';
    binding.setValue = function(v) {
      binding.original = v;
      binding.element.innerText = v.toString();
    };
    binding.getValue = function() {
      return binding.original;
    };
  </script>
</class>

<class name="list">
  <script>
    binding.model = [];
    binding.getValue = function() {
      var result = [];
      for (var i = 0; i < binding.model.length; ++i) {
        result.push(binding.model[i].getValue());
      }
      return result;
    };
    binding.setValue = function(v) {
      binding.model = [];
      binding.element.innerHTML = '';

      var contentTemplate = namespace.get('CONTENT');
      if (contentTemplate != null) {
        for (var i = 0; i < v.length; ++i) {
          if (('delimiter' in binding.attributes) && (i > 0)) {
            var span = document.createElement('SPAN');
            span.innerHTML = binding.attributes.delimiter;
            binding.element.appendChild(span);
          }

          var elementBinding = contentTemplate(null, null, null);
          binding.model.push(elementBinding);
          binding.element.appendChild(elementBinding.element);
          elementBinding.setValue(v[i]);

          if ('delete' in binding.attributes) {
            binding.appendDeleteButton(elementBinding);
          }
        }

        if ('add' in binding.attributes) {
          binding.appendAddButton(contentTemplate);
        }
      } else {
        binding.element.innerText = 'CONTENT is not defined';
      }
    };
    binding.appendDeleteButton = function(elementBinding) {
      var button = document.createElement('BUTTON');
      button.innerText = 'X';
      button.addEventListener('click', function(evt) {
        var modelIndex = binding.model.indexOf(elementBinding);
        binding.model.splice(modelIndex, 1);
        binding.element.removeChild(elementBinding.element);
        binding.element.removeChild(button);
      });

      if (elementBinding.element.nextSibling == null) {
        binding.element.appendChild(button);
      } else {
        binding.element.insertBefore(button, elementBinding.element.nextSibling);
      }
    };

    binding.appendAddButton = function(contentTemplate) {
      var button = document.createElement('BUTTON');
      button.innerText = '+';
      button.addEventListener('click', function(evt) {
        var elementBinding = contentTemplate(null, null, null);
        binding.model.push(elementBinding);
        binding.element.insertBefore(elementBinding.element, button);

        if ('delete' in binding.attributes) {
          binding.appendDeleteButton(elementBinding);
        }
      });
      binding.element.appendChild(button);
    };
  </script>
</class>
